@*
SPDX-License-Identifier: Apache-2.0
Licensed to the Ed-Fi Alliance under one or more agreements.
The Ed-Fi Alliance licenses this file to you under the Apache License, Version 2.0.
See the LICENSE and NOTICES files in the project root for more information.
*@

@using EdFi.Ods.AdminApp.Web.Helpers
@model EdFi.Ods.AdminApp.Web.Models.ViewModels.OdsInstances.BulkRegisterOdsInstancesModel
@{
    ViewBag.Title = "Ods Instances | Bulk Register";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h3 class="text-center padding-bottom-10">Bulk Register Ods Instances</h3>
@using (Html.BeginForm("BulkRegisterOdsInstances", "OdsInstances", FormMethod.Post, new { enctype = "multipart/form-data", id = "bulk-instances-registration-form" }))
{
    @Html.AntiForgeryToken()
    <div id="bulk-instances-registration-validation-summary" class="validationSummary alert alert-danger" hidden></div>
    <div class="row">
        <div class="col-md-8">
            @Html.FileInputBlock(x => x.OdsInstancesFile).Attr("accept", ".csv")
        </div>
    </div>
    <div class="row">
        <div class="padding-top-5 text-center col-md-10">
            @Html.Button("Back").Attr("type", "button").AddClass("back-btn back-ajax").Data("back-url", Url.Action("Index", "OdsInstances")).Id("ods-instance-settings-back-button")
            @Html.SaveButton("Register Instances").AddClasses("no-ajax", "bulk-register")
        </div>
    </div>
}

<script type="text/javascript">
    $('#bulk-instances-registration-form').submit(function (e) {
        e.preventDefault();
        var form = $(this);
        $(".bulk-register")
            .html('Registering Instances... <span class="padding-left"><i id="spinner" class="fa fa-spinner fa-pulse"></i></span>');
        $(".bulk-register").attr('disabled', true);
        var successHandler = function (data) {
            if (data.successMessage) {
                SetSuccessMessage(data.successMessage);
            }
            if (data.errorMessage) {
                SetErrorMessage(data.errorMessage);
            }
            ShowToasterMessage();
            ClearToasterMessage();
            form[0].reset();
            $('#ods-instance-settings-back-button').trigger('click');
        };
        var errorAdditionalBehavior = function () {
            $(".bulk-register").html('Register Instances');
            $(".bulk-register").attr('disabled', false);
        };
        var ajaxRequestData = {
            form: $(this),
            formData: new FormData(form[0]),
            cache: false,
            contentType: false,
            processData: false,
            successHandler: successHandler,
            errorAdditionalBehavior: errorAdditionalBehavior
        };
        submitAjaxForInnerTabs(ajaxRequestData);
    });
    $(function () {
        InitializeSubmitButtons();
        InitializeBackNavigationalAjaxButtons();
    });
</script>

